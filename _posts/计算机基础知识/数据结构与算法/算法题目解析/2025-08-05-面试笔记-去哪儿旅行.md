---
layout: post
title:  "面试复盘之去哪儿旅行"
date:   2025-08-06 22:47:14 +0800
categories: 工作 求职
---
## 面试复盘之去哪儿旅行

##### 面试体验极差，在确认我是华为od以后，就很不耐烦，没有任何技术上的交流，半小时就结束了面试。


### 1、对于接口返回时间长的问题应该如何排查？

#### 分层诊断：

1. 网络层：延迟/丢包

2. 应用层：线程阻塞/GC

3. 数据库层：慢SQL/锁竞争

4. 缓存层：缓存穿透/雪崩

#### 1. **网络层排查（<5%问题）**

- **关键命令**：

    bash

- ```
    # 连续测试链路质量（100个包）
    mtr -r -c 100 api.backend.com
    
    # 抓取HTTP请求耗时分布（TLS握手/TTFB等待）
    curl -w "TCP握手: %{time_connect}s | TLS握手: %{time_appconnect}s | 首字节: %{time_starttransfer}s | 总耗时: %{time_total}s\n" -o /dev/null -s https://api.backend.com
    ```

- **问题特征**：

    - `time_connect > 0.3s` → TCP握手慢（检查防火墙/路由）
    - `time_starttransfer > 1s` → 服务端处理延迟（转下层排查）

#### 2. **服务器层排查（15%问题）**

- **关键命令**：

    bash

- ```
    # 实时资源监控（每秒刷新）
    vmstat 1
    # 重点关注： 
    #   us%（用户CPU） >70% → 应用代码问题 
    #   wa%（I/O等待） >20% → 磁盘瓶颈
    
    # 磁盘I/O分析
    iostat -dx 1
    # 重点关注： 
    #   %util > 80% 或 await > 10ms → 磁盘过载
    ```

#### 3. **应用层深度剖析（60%问题）**

##### ▶ 线程阻塞分析（Java示例）

bash

```
# 使用Arthas查看线程阻塞
arthas-boot.jar
thread -n 3 --state BLOCKED  # 显示阻塞最严重的3个线程
```

- **典型场景**：
    - `synchronized`锁竞争 → 优化为`ReentrantLock`
    - 慢SQL导致线程池耗尽 → 数据库优化

##### ▶ GC问题排查

bash

```
# 查看GC频率与耗时
jstat -gcutil <pid> 1000

# 生成堆转储分析（MAT工具）
jmap -dump:live,format=b,file=heap.hprof <pid>
```

- **优化方案**：
    - Young GC频繁 → 增大新生代（`-Xmn`）
    - Full GC时间长 → 减少老年代对象（内存泄漏排查）

##### ▶ 代码级热点定位（Python示例）

python

```
# py-spy采样分析（需安装py-spy）
py-spy top --pid <python_pid>
# 输出火焰图：
py-spy record -o profile.svg --pid <python_pid>
```

#### 4. **数据库层优化（15%问题）**

##### ▶ 慢SQL捕获

sql

```
-- 开启慢查询日志（>1秒）
SET GLOBAL slow_query_log = ON;
SET GLOBAL long_query_time = 1;

-- 实时查看活跃慢SQL
SELECT * FROM information_schema.PROCESSLIST 
WHERE TIME > 2 AND COMMAND NOT IN ('Sleep');
```

##### ▶ 执行计划分析

sql

```
EXPLAIN SELECT * FROM orders WHERE user_id=100;
-- 重点关注：
--   type: ALL（全表扫描）→ 需加索引
--   Extra: Using filesort（文件排序）→ 优化ORDER BY
```

#### 5. **缓存层风险（5%问题）**

- **缓存击穿验证**：

    bash

```
# 模拟批量请求同一过期Key
redis-benchmark -t get -n 100000 -q -k 1 -c 50
```

**解决方案**：

- 布隆过滤器拦截无效Key
- 热点Key永不过期 + 异步更新
